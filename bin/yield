#!/usr/bin/env ruby
require 'rbconfig'
require 'optparse'
require_relative '../lib/yield'

# Determine if OS is Windows, and disable echo of characters in hat notation (^C) if it is not.
is_windows = (RbConfig::CONFIG['host_os'] =~ /mswin|mingw|cygwin/)
`stty -echoctl` unless is_windows

port = 4000

OptionParser.new do |o|
  o.banner = "Usage: #{o.program_name} MARKDOWN_FILE.md"

  o.on('-h', '--help', 'View the help menu') { puts o; Kernel.exit }
  o.on('-p PORT', '--port PORT', 'Specify port to run Yield on') { |o| port = o }
  o.on('-v', '--version', 'Display version number') do
    puts 'yield version ' + Yield::VERSION
    Kernel.exit
  end

  begin
    o.parse!
  rescue OptionParser::InvalidOption => o
    puts o.message
  end
end

# Parse a specific file if given, otherwise parse README.md.
ARGV.length == 1 ? Yield::Markdown.init(ARGV[0]) : Yield::Markdown.init
Yield::Server.run!(port)